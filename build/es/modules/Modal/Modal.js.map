{"version":3,"file":"Modal.js","sources":["../../../../src/react/modules/Modal/Modal.tsx"],"sourcesContent":["import * as React from 'react';\nimport clsx from 'clsx';\n\nimport {\n  MountNode,\n  childrenUtils\n} from '@appbuckets/react-ui-core';\n\nimport {\n  useElementType,\n  useSharedClassName\n} from '../../lib';\n\nimport { useAutoControlledValue } from '../../hooks/useAutoControlledValue';\n\nimport { Backdrop } from '../Backdrop';\n\nimport { Button } from '../../elements/Button';\nimport { Icon } from '../../elements/Icon';\n\nimport { ModalProps } from './Modal.types';\n\nimport { ModalProvider } from './Modal.context';\n\nimport ModalActions from './ModalActions';\nimport ModalContent from './ModalContent';\nimport ModalHeader from './ModalHeader';\n\n\n/* --------\n * Component Declare\n * -------- */\ntype ModalComponent = React.FunctionComponent<ModalProps> & {\n  Actions: typeof ModalActions;\n  Content: typeof ModalContent;\n  Header: typeof ModalHeader;\n};\n\n\n/* --------\n * Component Render\n * -------- */\nconst Modal: ModalComponent = (props) => {\n\n  // ----\n  // Get Modal Props\n  // ----\n  const {\n    className,\n    rest: {\n      /** Modal Props */\n      actions,\n      basic,\n      children,\n      closeIcon,\n      closeOnBackdropClick,\n      content,\n      header,\n      icon,\n      mountNode: userDefinedMountNode,\n      size,\n\n      /** Modal handlers */\n      onActionClick,\n      onClose,\n      onOpen,\n\n      /** Modal state Prop */\n      defaultOpen,\n      open: openProp,\n\n      /** Handled Backdrop Props */\n      loading,\n      loaderProps,\n\n      /** Handled Portal Props */\n      closeOnDocumentClick,\n      closeOnEscape,\n      openOnTriggerClick,\n      openOnTriggerFocus,\n      openOnTriggerMouseEnter,\n      trigger,\n      triggerRef,\n\n      /** All other Props */\n      ...rest\n    }\n  } = useSharedClassName(props);\n\n\n  // ----\n  // Init Modal Internal State\n  // ----\n  /** Init the AutoControlled open state */\n  const [ open, trySetOpen ] = useAutoControlledValue(\n    false,\n    { prop: openProp, defaultProp: defaultOpen }\n  );\n  /** Get the component element type */\n  const ElementType = useElementType(Modal, props);\n  /** Check if in this render modal has children */\n  const hasChildren = !childrenUtils.isNil(children);\n\n\n  // ----\n  // Define Modal Handlers\n  // ----\n  const handleModalClose = (e: React.MouseEvent<HTMLElement>) => {\n    /** Call User Handler if Exists */\n    if (onClose) {\n      onClose(e, props);\n    }\n    /** Try to close the modal */\n    trySetOpen(false);\n  };\n\n  const handleModalOpen = (e: React.MouseEvent<HTMLElement>) => {\n    /** Call User Handler if Exists */\n    if (onOpen) {\n      onOpen(e, props);\n    }\n    /** Try to open the modal */\n    trySetOpen(true);\n  };\n\n\n  // ----\n  // Build Component Classes\n  // ----\n  const contentClasses = clsx(\n    'modal',\n    size,\n    { basic },\n    icon && 'with-icon',\n    className\n  );\n\n  const mountNodeClasses = clsx(\n    'dimmable',\n    open && 'dimmed'\n  );\n\n\n  // ----\n  // Memoized Elements\n  // ----\n  const modalIconElement = React.useMemo(\n    () => icon && Icon.create(icon, {\n      autoGenerateKey: false,\n      overrideProps  : {\n        solid: 'inverted circle'\n      }\n    }),\n    [ icon ]\n  );\n\n  const closeIconElement = closeIcon && Button.create({\n    icon      : closeIcon,\n    flat      : true,\n    appearance: 'white shade'\n  }, {\n    autoGenerateKey: false,\n    defaultProps   : { className: 'close' },\n    overrideProps  : (predefinedProps) => ({\n      onClick: (e: React.MouseEvent<HTMLButtonElement>) => {\n        /** Call original user defined handler on icon */\n        if (predefinedProps.onClick) {\n          predefinedProps.onClick(e, predefinedProps);\n        }\n        /** Try to close the Modal */\n        handleModalClose(e);\n      }\n    })\n  });\n\n  const modalHeaderElement = React.useMemo(\n    () => {\n      /** Set empty component if is closed */\n      if (!open || !header) {\n        return null;\n      }\n      /** Create a new Modal Header using Shorthand Factory */\n      return ModalHeader.create(header, { autoGenerateKey: false });\n    },\n    [ open, header ]\n  );\n\n  const modalActionsElement = React.useMemo(\n    () => {\n      /** Set empty component if is closed */\n      if (hasChildren || !open || !actions) {\n        return null;\n      }\n      /** Create modal action element using Shorthand Factory */\n      return ModalActions.create(actions, {\n        autoGenerateKey: false,\n        overrideProps  : (predefinedProps) => ({\n          onActionClick: (e, buttonProps) => {\n            /** Call predefined on Action Click function */\n            if (predefinedProps.onActionClick) {\n              predefinedProps.onActionClick(e, buttonProps);\n            }\n            /** Call modal action click if exists */\n            if (onActionClick) {\n              onActionClick(e, buttonProps);\n            }\n          }\n        })\n      });\n    },\n    [ hasChildren, open, actions, onActionClick ]\n  );\n\n\n  // ----\n  // Init an internal function to build Modal Content\n  // ----\n  const renderModalContent = () => (\n    <ModalProvider value={{ closeModal: handleModalClose }}>\n      <ElementType {...rest} className={contentClasses}>\n        {/* Apply Class to Mount Node */}\n        <MountNode className={mountNodeClasses} node={userDefinedMountNode ?? document.body} />\n\n        {/* Render the Modal Icon if Exists */}\n        {modalIconElement}\n\n        {/* Render the Icon Close Element if Exists */}\n        {closeIconElement}\n\n        {/* Render the Modal Header */}\n        {modalHeaderElement}\n\n        {/* Render Modal Content */}\n        {!hasChildren ? (\n          <React.Fragment>\n            {ModalContent.create(content, { autoGenerateKey: false })}\n            {modalActionsElement}\n          </React.Fragment>\n        ) : (\n          typeof children === 'function'\n            ? children({ closeModal: handleModalClose })\n            : children\n        )}\n      </ElementType>\n    </ModalProvider>\n  );\n\n\n  // ----\n  // Render the Component\n  // ----\n  return (\n    <Backdrop\n      page\n      animated\n      className={'modals'}\n      visible={open}\n      closeOnBackdropClick={closeOnBackdropClick}\n      closeOnDocumentClick={closeOnDocumentClick}\n      closeOnEscape={closeOnEscape}\n      openOnTriggerClick={openOnTriggerClick}\n      openOnTriggerMouseEnter={openOnTriggerMouseEnter}\n      openOnTriggerFocus={openOnTriggerFocus}\n      trigger={trigger}\n      triggerRef={triggerRef}\n      verticalAlign={'on top'}\n      loading={loading}\n      loaderProps={loaderProps}\n      onClose={handleModalClose}\n      onOpen={handleModalOpen}\n    >\n      {renderModalContent()}\n    </Backdrop>\n  );\n};\n\nModal.displayName = 'Modal';\n\nModal.defaultProps = {\n  closeIcon           : 'times',\n  closeOnDocumentClick: false,\n  closeOnBackdropClick: true\n};\n\nModal.Actions = ModalActions;\nModal.Content = ModalContent;\nModal.Header = ModalHeader;\n\nexport default Modal;\n"],"names":["useSharedClassName","useAutoControlledValue","useElementType","childrenUtils","clsx","React.useMemo","React.createElement","ModalProvider","MountNode","React.Fragment"],"mappings":"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"}