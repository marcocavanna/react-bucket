{"version":3,"file":"Popup.js","sources":["../../../../src/react/modules/Popup/Popup.tsx"],"sourcesContent":["import * as React from 'react';\nimport clsx from 'clsx';\n\nimport EventStack, { instance as eventStack } from '@semantic-ui-react/event-stack';\n\nimport { usePopper } from 'react-popper';\n\nimport {\n  childrenUtils,\n  Portal,\n  PortalProps\n} from '@appbuckets/react-ui-core';\n\nimport {\n  useSharedClassName,\n  useElementType\n} from '../../lib';\n\nimport { PopupProps } from './Popup.types';\nimport {\n  usePopperModifiers,\n  usePopperPlacementMapping,\n  usePortalProps\n} from './lib/internalHooks';\n\nimport { Header } from '../../elements/Header';\n\n\n/* --------\n * Component Declare\n * -------- */\ntype PopupComponent = React.FunctionComponent<PopupProps>;\n\n\n/* --------\n * Component Render\n * -------- */\nconst Popup: PopupComponent = (props) => {\n\n  // ----\n  // Destructuring Props\n  // ----\n  const {\n    className,\n    rest: {\n      children,\n      content,\n      basic,\n      disabled,\n      hideOnScroll,\n      hideOnScrollDelay,\n      hoverable,\n      inverted,\n      offset,\n      onClose,\n      onMount,\n      onOpen,\n      onOutsideClick,\n      onUnmount,\n      openOn,\n      position,\n      popperModifiers: userDefinedPopperModifiers,\n      portalProps    : userDefinedPortalProps,\n      updateDependencies,\n      trigger,\n      style          : userDefinedStyle,\n      ...rest\n    }\n  } = useSharedClassName(props);\n\n\n  // ----\n  // Reference Handling\n  // ----\n  const [ referenceElement, setReferenceElement ] = React.useState<HTMLElement | null>();\n  const [ popperElement, setPopperElement ] = React.useState<HTMLElement | null>();\n\n\n  // ----\n  // Internal State Definition\n  // ----\n  const [ closed, setClosed ] = React.useState<boolean>(false);\n  const [ closeTimeout, setCloseTimeout ] = React.useState<NodeJS.Timeout | number>();\n\n\n  // ----\n  // Popper Building\n  // ----\n  const popperModifiers = usePopperModifiers(\n    [\n      { name: 'arrow', enabled: false },\n      { name: 'offset', enabled: !!offset, options: { offset } },\n      { name: 'preventOverflow', enabled: false }\n    ],\n    userDefinedPopperModifiers ?? [],\n    [ offset ]\n  );\n\n  /** Get Popper Placement using Position */\n  const popperPlacement = usePopperPlacementMapping(position);\n\n  const {\n    styles: popperStyle,\n    attributes,\n    update: scheduleUpdate\n  } = usePopper(\n    referenceElement,\n    popperElement,\n    {\n      modifiers: popperModifiers,\n      placement: popperPlacement\n    }\n  );\n\n\n  // ----\n  // Component LifeCycle Hooks\n  // ----\n  React.useEffect(\n    () => {\n      /** On Dependencies Update, reload Position */\n      if (scheduleUpdate) {\n        scheduleUpdate();\n      }\n    },\n    // eslint-disable-next-line\n    updateDependencies ? [ scheduleUpdate, ...updateDependencies ] : [ scheduleUpdate, true ]\n  );\n\n  React.useEffect(\n    () => () => {\n      /** On Component Unmount, clear close Timer */\n      if (closeTimeout) {\n        clearTimeout(closeTimeout as NodeJS.Timeout);\n      }\n    },\n    [ closeTimeout ]\n  );\n\n\n  // ----\n  // Component Internal Hooks\n  // ----\n  const ElementType = useElementType(Popup, props);\n  const portalProps: PortalProps = usePortalProps(userDefinedPortalProps, props);\n\n\n  // ----\n  // Avoid Component Render if Popup is Closed or Disabled\n  // ----\n  if (closed || disabled) {\n    return trigger ?? null;\n  }\n\n\n  // ----\n  // Portal Event Handling\n  // ----\n  const handlePortalClose = (event: React.MouseEvent<HTMLElement>) => {\n    if (typeof onClose === 'function') {\n      onClose(event, props);\n    }\n  };\n\n  const handlePortalMount = () => {\n    if (typeof onMount === 'function') {\n      onMount(null, props);\n    }\n  };\n\n  const handlePortalOpen = (event: React.MouseEvent<HTMLElement>) => {\n    if (typeof onOpen === 'function') {\n      onOpen(event, props);\n    }\n  };\n\n  const handlePortalUnmount = () => {\n    if (typeof onUnmount === 'function') {\n      onUnmount(null, props);\n    }\n  };\n\n  const handlePopupClick = (event: React.MouseEvent<HTMLElement>) => {\n    if (!basic && !inverted) {\n      event.stopPropagation();\n    }\n  };\n\n\n  // ----\n  // Scroll Handler\n  // ----\n  const handleHideOnScroll = (event: Event) => {\n    setClosed(true);\n\n    eventStack.unsub('scroll', handleHideOnScroll, { target: 'window' });\n\n    setCloseTimeout(setTimeout(() => {\n      setClosed(false);\n    }, hideOnScrollDelay));\n\n    handlePortalClose(event as unknown as React.MouseEvent<HTMLElement>);\n  };\n\n\n  // ----\n  // Popup Content Build\n  // ----\n  const style: React.CSSProperties = {\n    left : 'auto',\n    right: 'auto',\n    ...popperStyle.popper,\n    ...userDefinedStyle\n  };\n\n  const classes = clsx(\n    'visible',\n    { inverted, basic, hoverable },\n    position,\n    'popup',\n    className\n  );\n\n  /** Build Content */\n  const popupContent = (\n    <ElementType\n      {...rest}\n      ref={setPopperElement}\n      className={classes}\n      style={style}\n      onClick={handlePopupClick}\n      {...attributes.popper}\n    >\n      <div className={'content'}>\n        {\n          childrenUtils.isNil(children)\n            ? Header.create(content, { autoGenerateKey: false })\n            : children\n        }\n      </div>\n\n      {hideOnScroll && (\n        <EventStack\n          on={handleHideOnScroll}\n          name={'scroll'}\n          target={'window'}\n        />\n      )}\n    </ElementType>\n  );\n\n\n  // ----\n  // Component Render\n  // ----\n  return (\n    <Portal\n      {...portalProps}\n      trigger={trigger}\n      triggerRef={setReferenceElement}\n      onClose={handlePortalClose}\n      onMount={handlePortalMount}\n      onOpen={handlePortalOpen}\n      onUnmount={handlePortalUnmount}\n    >\n      {popupContent}\n    </Portal>\n  );\n};\n\nPopup.displayName = 'Popup';\n\nPopup.defaultProps = {\n  basic            : true,\n  inverted         : true,\n  hideOnScrollDelay: 50,\n  offset           : [ 0, 5 ],\n  openOn           : [ 'hover' ],\n  position         : 'top center'\n};\n\nexport default Popup;\n"],"names":["useSharedClassName","React.useState","usePopperModifiers","usePopperPlacementMapping","usePopper","React.useEffect","useElementType","usePortalProps","eventStack","clsx","React.createElement","childrenUtils","EventStack","Portal"],"mappings":";;;;;;;;;;;;;;;;;;AAkCA;;;IAGM,KAAK,GAAmB,UAAC,KAAK;;;;QAK5B,KA0BFA,6BAAkB,CAAC,KAAK,CAAC,EAzB3B,SAAS,eAAA,EACT,YAuBC,EAtBC,QAAQ,cAAA,EACR,OAAO,aAAA,EACP,KAAK,WAAA,EACL,QAAQ,cAAA,EACR,YAAY,kBAAA,EACZ,iBAAiB,uBAAA,EACjB,SAAS,eAAA,EACT,QAAQ,cAAA,EACR,MAAM,YAAA,EACN,OAAO,aAAA,EACP,OAAO,aAAA,EACP,MAAM,YAAA,EAEN,SAAS,eAAA,EAET,QAAQ,cAAA,EACS,0BAA0B,qBAAA,EAC1B,sBAAsB,iBAAA,EACvC,kBAAkB,wBAAA,EAClB,OAAO,aAAA,EACU,gBAAgB,WAAA,EAC9B,IAAI,qBAtBH,qRAuBL,EAC2B;;;;IAMxB,IAAA,KAA4CC,cAAc,EAAsB,EAA9E,gBAAgB,QAAA,EAAE,mBAAmB,QAAyC,CAAC;IACjF,IAAA,KAAsCA,cAAc,EAAsB,EAAxE,aAAa,QAAA,EAAE,gBAAgB,QAAyC,CAAC;;;;IAM3E,IAAA,KAAwBA,cAAc,CAAU,KAAK,CAAC,EAApD,MAAM,QAAA,EAAE,SAAS,QAAmC,CAAC;IACvD,IAAA,KAAoCA,cAAc,EAA2B,EAA3E,YAAY,QAAA,EAAE,eAAe,QAA8C,CAAC;;;;IAMpF,IAAM,eAAe,GAAGC,gCAAkB,CACxC;QACE,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE;QACjC,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,EAAE,MAAM,QAAA,EAAE,EAAE;QAC1D,EAAE,IAAI,EAAE,iBAAiB,EAAE,OAAO,EAAE,KAAK,EAAE;KAC5C,EACD,0BAA0B,aAA1B,0BAA0B,cAA1B,0BAA0B,GAAI,EAAE,EAChC,CAAE,MAAM,CAAE,CACX,CAAC;;IAGF,IAAM,eAAe,GAAGC,uCAAyB,CAAC,QAAQ,CAAC,CAAC;IAEtD,IAAA,KAIFC,qBAAS,CACX,gBAAgB,EAChB,aAAa,EACb;QACE,SAAS,EAAE,eAAe;QAC1B,SAAS,EAAE,eAAe;KAC3B,CACF,EAVS,WAAW,YAAA,EACnB,UAAU,gBAAA,EACF,cAAc,YAQvB,CAAC;;;;IAMFC,eAAe,CACb;;QAEE,IAAI,cAAc,EAAE;YAClB,cAAc,EAAE,CAAC;SAClB;KACF;;IAED,kBAAkB,0BAAK,cAAc,GAAK,kBAAkB,IAAK,CAAE,cAAc,EAAE,IAAI,CAAE,CAC1F,CAAC;IAEFA,eAAe,CACb,cAAM,OAAA;;QAEJ,IAAI,YAAY,EAAE;YAChB,YAAY,CAAC,YAA8B,CAAC,CAAC;SAC9C;KACF,GAAA,EACD,CAAE,YAAY,CAAE,CACjB,CAAC;;;;IAMF,IAAM,WAAW,GAAGC,yBAAc,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;IACjD,IAAM,WAAW,GAAgBC,4BAAc,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;;;;IAM/E,IAAI,MAAM,IAAI,QAAQ,EAAE;QACtB,OAAO,OAAO,aAAP,OAAO,cAAP,OAAO,GAAI,IAAI,CAAC;KACxB;;;;IAMD,IAAM,iBAAiB,GAAG,UAAC,KAAoC;QAC7D,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;YACjC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;SACvB;KACF,CAAC;IAEF,IAAM,iBAAiB,GAAG;QACxB,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;YACjC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SACtB;KACF,CAAC;IAEF,IAAM,gBAAgB,GAAG,UAAC,KAAoC;QAC5D,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;YAChC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;SACtB;KACF,CAAC;IAEF,IAAM,mBAAmB,GAAG;QAC1B,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE;YACnC,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SACxB;KACF,CAAC;IAEF,IAAM,gBAAgB,GAAG,UAAC,KAAoC;QAC5D,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,EAAE;YACvB,KAAK,CAAC,eAAe,EAAE,CAAC;SACzB;KACF,CAAC;;;;IAMF,IAAM,kBAAkB,GAAG,UAAC,KAAY;QACtC,SAAS,CAAC,IAAI,CAAC,CAAC;QAEhBC,mBAAU,CAAC,KAAK,CAAC,QAAQ,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC;QAErE,eAAe,CAAC,UAAU,CAAC;YACzB,SAAS,CAAC,KAAK,CAAC,CAAC;SAClB,EAAE,iBAAiB,CAAC,CAAC,CAAC;QAEvB,iBAAiB,CAAC,KAAiD,CAAC,CAAC;KACtE,CAAC;;;;IAMF,IAAM,KAAK,qCACT,IAAI,EAAG,MAAM,EACb,KAAK,EAAE,MAAM,IACV,WAAW,CAAC,MAAM,GAClB,gBAAgB,CACpB,CAAC;IAEF,IAAM,OAAO,GAAGC,wBAAI,CAClB,SAAS,EACT,EAAE,QAAQ,UAAA,EAAE,KAAK,OAAA,EAAE,SAAS,WAAA,EAAE,EAC9B,QAAQ,EACR,OAAO,EACP,SAAS,CACV,CAAC;;IAGF,IAAM,YAAY,IAChBC,oBAAC,WAAW,sBACN,IAAI,IACR,GAAG,EAAE,gBAAgB,EACrB,SAAS,EAAE,OAAO,EAClB,KAAK,EAAE,KAAK,EACZ,OAAO,EAAE,gBAAgB,IACrB,UAAU,CAAC,MAAM;QAErBA,6BAAK,SAAS,EAAE,SAAS,IAErBC,yBAAa,CAAC,KAAK,CAAC,QAAQ,CAAC;cACzB,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,eAAe,EAAE,KAAK,EAAE,CAAC;cAClD,QAAQ,CAEV;QAEL,YAAY,KACXD,oBAACE,8BAAU,IACT,EAAE,EAAE,kBAAkB,EACtB,IAAI,EAAE,QAAQ,EACd,MAAM,EAAE,QAAQ,GAChB,CACH,CACW,CACf,CAAC;;;;IAMF,QACEF,oBAACG,kBAAM,sBACD,WAAW,IACf,OAAO,EAAE,OAAO,EAChB,UAAU,EAAE,mBAAmB,EAC/B,OAAO,EAAE,iBAAiB,EAC1B,OAAO,EAAE,iBAAiB,EAC1B,MAAM,EAAE,gBAAgB,EACxB,SAAS,EAAE,mBAAmB,KAE7B,YAAY,CACN,EACT;AACJ,EAAE;AAEF,KAAK,CAAC,WAAW,GAAG,OAAO,CAAC;AAE5B,KAAK,CAAC,YAAY,GAAG;IACnB,KAAK,EAAc,IAAI;IACvB,QAAQ,EAAW,IAAI;IACvB,iBAAiB,EAAE,EAAE;IACrB,MAAM,EAAa,CAAE,CAAC,EAAE,CAAC,CAAE;IAC3B,MAAM,EAAa,CAAE,OAAO,CAAE;IAC9B,QAAQ,EAAW,YAAY;CAChC;;;;"}